(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[931],{747:function(e,t,n){Promise.resolve().then(n.bind(n,4703))},357:function(e,t,n){"use strict";var r,i;e.exports=(null==(r=n.g.process)?void 0:r.env)&&"object"==typeof(null==(i=n.g.process)?void 0:i.env)?n.g.process:n(8081)},8081:function(e){!function(){var t={229:function(e){var t,n,r,i=e.exports={};function o(){throw Error("setTimeout has not been defined")}function s(){throw Error("clearTimeout has not been defined")}function a(e){if(t===setTimeout)return setTimeout(e,0);if((t===o||!t)&&setTimeout)return t=setTimeout,setTimeout(e,0);try{return t(e,0)}catch(n){try{return t.call(null,e,0)}catch(n){return t.call(this,e,0)}}}!function(){try{t="function"==typeof setTimeout?setTimeout:o}catch(e){t=o}try{n="function"==typeof clearTimeout?clearTimeout:s}catch(e){n=s}}();var c=[],l=!1,u=-1;function f(){l&&r&&(l=!1,r.length?c=r.concat(c):u=-1,c.length&&d())}function d(){if(!l){var e=a(f);l=!0;for(var t=c.length;t;){for(r=c,c=[];++u<t;)r&&r[u].run();u=-1,t=c.length}r=null,l=!1,function(e){if(n===clearTimeout)return clearTimeout(e);if((n===s||!n)&&clearTimeout)return n=clearTimeout,clearTimeout(e);try{n(e)}catch(t){try{return n.call(null,e)}catch(t){return n.call(this,e)}}}(e)}}function g(e,t){this.fun=e,this.array=t}function h(){}i.nextTick=function(e){var t=Array(arguments.length-1);if(arguments.length>1)for(var n=1;n<arguments.length;n++)t[n-1]=arguments[n];c.push(new g(e,t)),1!==c.length||l||a(d)},g.prototype.run=function(){this.fun.apply(null,this.array)},i.title="browser",i.browser=!0,i.env={},i.argv=[],i.version="",i.versions={},i.on=h,i.addListener=h,i.once=h,i.off=h,i.removeListener=h,i.removeAllListeners=h,i.emit=h,i.prependListener=h,i.prependOnceListener=h,i.listeners=function(e){return[]},i.binding=function(e){throw Error("process.binding is not supported")},i.cwd=function(){return"/"},i.chdir=function(e){throw Error("process.chdir is not supported")},i.umask=function(){return 0}}},n={};function r(e){var i=n[e];if(void 0!==i)return i.exports;var o=n[e]={exports:{}},s=!0;try{t[e](o,o.exports,r),s=!1}finally{s&&delete n[e]}return o.exports}r.ab="//";var i=r(229);e.exports=i}()},4492:function(e,t,n){"use strict";/**
 * @license React
 * use-sync-external-store-shim.production.min.js
 *
 * Copyright (c) Facebook, Inc. and its affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */var r=n(2265),i="function"==typeof Object.is?Object.is:function(e,t){return e===t&&(0!==e||1/e==1/t)||e!=e&&t!=t},o=r.useState,s=r.useEffect,a=r.useLayoutEffect,c=r.useDebugValue;function l(e){var t=e.getSnapshot;e=e.value;try{var n=t();return!i(e,n)}catch(e){return!0}}var u="undefined"==typeof window||void 0===window.document||void 0===window.document.createElement?function(e,t){return t()}:function(e,t){var n=t(),r=o({inst:{value:n,getSnapshot:t}}),i=r[0].inst,u=r[1];return a(function(){i.value=n,i.getSnapshot=t,l(i)&&u({inst:i})},[e,n,t]),s(function(){return l(i)&&u({inst:i}),e(function(){l(i)&&u({inst:i})})},[e]),c(n),n};t.useSyncExternalStore=void 0!==r.useSyncExternalStore?r.useSyncExternalStore:u},5107:function(e,t,n){"use strict";/**
 * @license React
 * use-sync-external-store-shim/with-selector.production.min.js
 *
 * Copyright (c) Facebook, Inc. and its affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */var r=n(2265),i=n(554),o="function"==typeof Object.is?Object.is:function(e,t){return e===t&&(0!==e||1/e==1/t)||e!=e&&t!=t},s=i.useSyncExternalStore,a=r.useRef,c=r.useEffect,l=r.useMemo,u=r.useDebugValue;t.useSyncExternalStoreWithSelector=function(e,t,n,r,i){var f=a(null);if(null===f.current){var d={hasValue:!1,value:null};f.current=d}else d=f.current;var g=s(e,(f=l(function(){function e(e){if(!c){if(c=!0,s=e,e=r(e),void 0!==i&&d.hasValue){var t=d.value;if(i(t,e))return a=t}return a=e}if(t=a,o(s,e))return t;var n=r(e);return void 0!==i&&i(t,n)?t:(s=e,a=n)}var s,a,c=!1,l=void 0===n?null:n;return[function(){return e(t())},null===l?void 0:function(){return e(l())}]},[t,n,r,i]))[0],f[1]);return c(function(){d.hasValue=!0,d.value=g},[g]),u(g),g}},554:function(e,t,n){"use strict";e.exports=n(4492)},5006:function(e,t,n){"use strict";e.exports=n(5107)},4703:function(e,t,n){"use strict";let r;n.r(t),n.d(t,{default:function(){return F}});var i=n(7437),o=n(2265),s=n(357);let a=e=>{let t=s.env.NEXT_PUBLIC_ASSET_PATH||"";return"".concat(t,"/").concat(e)};function c(){return(0,i.jsx)("div",{className:"card text-primary-content w-full",children:(0,i.jsx)("a",{href:"https://bodysynths.com/",children:(0,i.jsx)("img",{src:a("header.png"),alt:"Example Image"})})})}let l=e=>{let t;let n=new Set,r=(e,r)=>{let i="function"==typeof e?e(t):e;if(!Object.is(i,t)){let e=t;t=(null!=r?r:"object"!=typeof i||null===i)?i:Object.assign({},t,i),n.forEach(n=>n(t,e))}},i=()=>t,o={setState:r,getState:i,getInitialState:()=>s,subscribe:e=>(n.add(e),()=>n.delete(e)),destroy:()=>{console.warn("[DEPRECATED] The `destroy` method will be unsupported in a future version. Instead use unsubscribe function returned by subscribe. Everything will be garbage-collected if store is garbage-collected."),n.clear()}},s=t=e(r,i,o);return o},u=e=>e?l(e):l;var f=n(5006);let{useDebugValue:d}=o,{useSyncExternalStoreWithSelector:g}=f,h=!1,p=e=>e,m=e=>{"function"!=typeof e&&console.warn("[DEPRECATED] Passing a vanilla store will be unsupported in a future version. Instead use `import { useStore } from 'zustand'`.");let t="function"==typeof e?u(e):e,n=(e,n)=>(function(e,t=p,n){n&&!h&&(console.warn("[DEPRECATED] Use `createWithEqualityFn` instead of `create` or use `useStoreWithEqualityFn` instead of `useStore`. They can be imported from 'zustand/traditional'. https://github.com/pmndrs/zustand/discussions/1937"),h=!0);let r=g(e.subscribe,e.getState,e.getServerState||e.getInitialState,t,n);return d(r),r})(t,e,n);return Object.assign(n,t),n},v=(r=e=>({device:null,firmwareBinFile:null,manifestationTolerant:!1}))?m(r):m;function D(e){let{options:t,onSelect:n,curOption:r}=e,[s,a]=(0,o.useState)(!1),c=e=>{n(e),a(!1)},l=e=>{a(!1),c(e)};return(0,i.jsxs)("div",{className:"dropdown",children:[(0,i.jsx)("button",{className:"btn m-1",onClick:()=>a(!0),children:r?r.title:"Select Firmware"}),s&&(0,i.jsx)("ul",{className:"menu dropdown-content bg-base-100 rounded-box z-[1] w-52 p-2 shadow",children:t.map((e,t)=>(0,i.jsx)("li",{children:(0,i.jsx)("button",{onClick:()=>l(t),children:e.title})},t))})]})}function y(){let[e,t]=(0,o.useState)([]),[n,r]=(0,o.useState)(""),s=v(e=>e.firmwareBinFile),c="number"==typeof n;return(0,o.useEffect)(()=>{fetch(a("releases.json")).then(e=>e.json()).then(e=>{t(e.data.sort((e,t)=>new Date(t.date)-new Date(e.date)))}).catch(e=>{console.error("Error fetching releases:",e)})},[]),(0,o.useEffect)(()=>{e.length>0&&!c&&r(0)},[e]),(0,o.useEffect)(()=>{if(!c){v.setState({firmwareBinFile:null});return}let t=e[n].file;fetch(a("firmware/".concat(t,".bin"))).then(e=>e.arrayBuffer()).then(e=>{v.setState({firmwareBinFile:new Uint8Array(e)})}).catch(e=>{console.error("Error loading file:",e)})},[n]),(0,i.jsx)("div",{className:"card bg-primary text-primary-content w-full",children:(0,i.jsxs)("div",{className:"card-body",children:[(0,i.jsx)("h2",{className:"card-title",children:"Select a Release"}),(0,i.jsx)("p",{children:s?(0,i.jsxs)(i.Fragment,{children:["Firmware binary loaded successfully for"," ",e[n].title,". Size: ",s.length," ","bytes"]}):(0,i.jsx)(i.Fragment,{children:"Select a file to load."})}),(0,i.jsx)("div",{className:"card-actions justify-end",children:(0,i.jsx)(D,{options:e,onSelect:r,curOption:e[n]})})]})})}let b={};b.DETACH=0,b.DNLOAD=1,b.UPLOAD=2,b.GETSTATUS=3,b.CLRSTATUS=4,b.GETSTATE=5,b.ABORT=6,b.appIDLE=0,b.appDETACH=1,b.dfuIDLE=2,b.dfuDNLOAD_SYNC=3,b.dfuDNBUSY=4,b.dfuDNLOAD_IDLE=5,b.dfuMANIFEST_SYNC=6,b.dfuMANIFEST=7,b.dfuMANIFEST_WAIT_RESET=8,b.dfuUPLOAD_IDLE=9,b.dfuERROR=10,b.STATUS_OK=0,b.Device=function(e,t){this.device_=e,this.settings=t,this.intfNumber=t.interface.interfaceNumber},b.findDeviceDfuInterfaces=function(e){let t=[];for(let n of e.configurations)for(let e of n.interfaces)for(let r of e.alternates)if(254==r.interfaceClass&&1==r.interfaceSubclass&&(1==r.interfaceProtocol||2==r.interfaceProtocol)){let i={configuration:n,interface:e,alternate:r,name:r.interfaceName};t.push(i)}return t},b.findAllDfuInterfaces=function(){return navigator.usb.getDevices().then(e=>{let t=[];for(let n of e)for(let e of b.findDeviceDfuInterfaces(n))t.push(new b.Device(n,e));return t})},b.Device.prototype.logDebug=function(e){console.log("logdebug: ",e)},b.Device.prototype.logInfo=function(e){console.log("logInfo: ",e)},b.Device.prototype.logWarning=function(e){console.log("logWarning: ",e)},b.Device.prototype.logError=function(e){console.log("logError: ",e)},b.Device.prototype.logProgress=function(e,t){void 0===t?console.log(e):console.log(e+"/"+t)},b.Device.prototype.open=async function(){await this.device_.open();let e=this.settings.configuration.configurationValue;(null===this.device_.configuration||this.device_.configuration.configurationValue!=e)&&await this.device_.selectConfiguration(e);let t=this.settings.interface.interfaceNumber;this.device_.configuration.interfaces[t].claimed||await this.device_.claimInterface(t);let n=this.settings.alternate.alternateSetting,r=this.device_.configuration.interfaces[t];(null===r.alternate||r.alternate.alternateSetting!=n)&&await this.device_.selectAlternateInterface(t,n)},b.Device.prototype.close=async function(){try{await this.device_.close()}catch(e){console.log(e)}},b.Device.prototype.readDeviceDescriptor=function(){return this.device_.controlTransferIn({requestType:"standard",recipient:"device",request:6,value:256,index:0},18).then(e=>"ok"==e.status?Promise.resolve(e.data):Promise.reject(e.status))},b.Device.prototype.readStringDescriptor=async function(e,t){void 0===t&&(t=0);let n={requestType:"standard",recipient:"device",request:6,value:768|e,index:t};var r=await this.device_.controlTransferIn(n,1);if("ok"==r.status){let e=r.data.getUint8(0);if("ok"==(r=await this.device_.controlTransferIn(n,e)).status){let n=(e-2)/2,i=[];for(let e=0;e<n;e++)i.push(r.data.getUint16(2+2*e,!0));return 0==t?i:String.fromCharCode.apply(String,i)}}throw"Failed to read string descriptor ".concat(e,": ").concat(r.status)},b.Device.prototype.readInterfaceNames=async function(){let e={},t=new Set;for(let n=0;n<this.device_.configurations.length;n++){let r=await this.readConfigurationDescriptor(n),i=b.parseConfigurationDescriptor(r),o=i.bConfigurationValue;for(let n of(e[o]={},i.descriptors))4==n.bDescriptorType&&(n.bInterfaceNumber in e[o]||(e[o][n.bInterfaceNumber]={}),e[o][n.bInterfaceNumber][n.bAlternateSetting]=n.iInterface,n.iInterface>0&&t.add(n.iInterface))}let n={};for(let e of t)try{n[e]=await this.readStringDescriptor(e,1033)}catch(t){console.log(t),n[e]=null}for(let t in e)for(let r in e[t])for(let i in e[t][r]){let o=e[t][r][i];e[t][r][i]=n[o]}return e},b.parseDeviceDescriptor=function(e){return{bLength:e.getUint8(0),bDescriptorType:e.getUint8(1),bcdUSB:e.getUint16(2,!0),bDeviceClass:e.getUint8(4),bDeviceSubClass:e.getUint8(5),bDeviceProtocol:e.getUint8(6),bMaxPacketSize:e.getUint8(7),idVendor:e.getUint16(8,!0),idProduct:e.getUint16(10,!0),bcdDevice:e.getUint16(12,!0),iManufacturer:e.getUint8(14),iProduct:e.getUint8(15),iSerialNumber:e.getUint8(16),bNumConfigurations:e.getUint8(17)}},b.parseConfigurationDescriptor=function(e){let t=new DataView(e.buffer.slice(9)),n=b.parseSubDescriptors(t);return{bLength:e.getUint8(0),bDescriptorType:e.getUint8(1),wTotalLength:e.getUint16(2,!0),bNumInterfaces:e.getUint8(4),bConfigurationValue:e.getUint8(5),iConfiguration:e.getUint8(6),bmAttributes:e.getUint8(7),bMaxPower:e.getUint8(8),descriptors:n}},b.parseInterfaceDescriptor=function(e){return{bLength:e.getUint8(0),bDescriptorType:e.getUint8(1),bInterfaceNumber:e.getUint8(2),bAlternateSetting:e.getUint8(3),bNumEndpoints:e.getUint8(4),bInterfaceClass:e.getUint8(5),bInterfaceSubClass:e.getUint8(6),bInterfaceProtocol:e.getUint8(7),iInterface:e.getUint8(8),descriptors:[]}},b.parseFunctionalDescriptor=function(e){return{bLength:e.getUint8(0),bDescriptorType:e.getUint8(1),bmAttributes:e.getUint8(2),wDetachTimeOut:e.getUint16(3,!0),wTransferSize:e.getUint16(5,!0),bcdDFUVersion:e.getUint16(7,!0)}},b.parseSubDescriptors=function(e){let t;let n=e,r=[],i=!1;for(;n.byteLength>2;){let e=n.getUint8(0),o=n.getUint8(1),s=new DataView(n.buffer.slice(0,e));if(4==o)i=254==(t=b.parseInterfaceDescriptor(s)).bInterfaceClass&&1==t.bInterfaceSubClass,r.push(t);else if(i&&33==o){let e=b.parseFunctionalDescriptor(s);r.push(e),t.descriptors.push(e)}else{let n={bLength:e,bDescriptorType:o,data:s};r.push(n),t&&t.descriptors.push(n)}n=new DataView(n.buffer.slice(e))}return r},b.Device.prototype.readConfigurationDescriptor=function(e){let t=512|e;return this.device_.controlTransferIn({requestType:"standard",recipient:"device",request:6,value:t,index:0},4).then(e=>{if("ok"!=e.status)return Promise.reject(e.status);{let n=e.data.getUint16(2,!0);return this.device_.controlTransferIn({requestType:"standard",recipient:"device",request:6,value:t,index:0},n)}}).then(e=>"ok"==e.status?Promise.resolve(e.data):Promise.reject(e.status))},b.Device.prototype.requestOut=function(e,t){let n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0;return this.device_.controlTransferOut({requestType:"class",recipient:"interface",request:e,value:n,index:this.intfNumber},t).then(e=>"ok"==e.status?Promise.resolve(e.bytesWritten):Promise.reject(e.status),e=>Promise.reject("ControlTransferOut failed: "+e))},b.Device.prototype.requestIn=function(e,t){let n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0;return console.log("requestIn: ",e,t,n),this.device_.controlTransferIn({requestType:"class",recipient:"interface",request:e,value:n,index:this.intfNumber},t).then(e=>"ok"==e.status?Promise.resolve(e.data):Promise.reject(e.status),e=>Promise.reject("ControlTransferIn failed: "+e))},b.Device.prototype.detach=function(){return this.requestOut(b.DETACH,void 0,1e3)},b.Device.prototype.waitDisconnected=async function(e){let t=this,n=this.device_;return new Promise(function(r,i){let o;e>0&&(o=setTimeout(i,e)),navigator.usb.addEventListener("disconnect",function i(s){s.device===n&&(e>0&&clearTimeout(o),t.disconnected=!0,navigator.usb.removeEventListener("disconnect",i),s.stopPropagation(),r(t))})})},b.Device.prototype.download=function(e,t){return this.requestOut(b.DNLOAD,e,t)},b.Device.prototype.dnload=b.Device.prototype.download,b.Device.prototype.upload=function(e,t){return this.requestIn(b.UPLOAD,e,t)},b.Device.prototype.clearStatus=function(){return this.requestOut(b.CLRSTATUS)},b.Device.prototype.clrStatus=b.Device.prototype.clearStatus,b.Device.prototype.getStatus=function(){return this.requestIn(b.GETSTATUS,6).then(e=>Promise.resolve({status:e.getUint8(0),pollTimeout:16777215&e.getUint32(1,!0),state:e.getUint8(4)}),e=>Promise.reject("DFU GETSTATUS failed: "+e))},b.Device.prototype.getState=function(){return this.requestIn(b.GETSTATE,1).then(e=>Promise.resolve(e.getUint8(0)),e=>Promise.reject("DFU GETSTATE failed: "+e))},b.Device.prototype.abort=function(){return this.requestOut(b.ABORT)},b.Device.prototype.abortToIdle=async function(){await this.abort();let e=await this.getState();if(e==b.dfuERROR&&(await this.clearStatus(),e=await this.getState()),e!=b.dfuIDLE)throw"Failed to return to idle state after abort: state "+e.state},b.Device.prototype.do_upload=async function(e){let t,n,r=arguments.length>1&&void 0!==arguments[1]?arguments[1]:1/0,i=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0,o=i,s=[],a=0;this.logInfo("Copying data from DFU device to browser"),this.logProgress(0);do n=Math.min(e,r-a),t=await this.upload(n,o++),this.logDebug("Read "+t.byteLength+" bytes"),t.byteLength>0&&(s.push(t),a+=t.byteLength),Number.isFinite(r)?this.logProgress(a,r):this.logProgress(a);while(a<r&&t.byteLength==n);return a==r&&await this.abortToIdle(),this.logInfo("Read ".concat(a," bytes")),new Blob(s,{type:"application/octet-stream"})},b.Device.prototype.poll_until=async function(e){console.log("DEVICE poll_until getStatus");let t=await this.getStatus();console.log("dfu_status: ",t);let n=this;for(console.log("DEVICE poll_until");!e(t.state)&&t.state!=b.dfuERROR;)await function(e){return new Promise(function(t,r){n.logDebug("Sleeping for "+e+"ms"),setTimeout(t,e)})}(t.pollTimeout),console.log("dfu_status: ",t=await this.getStatus());return t},b.Device.prototype.poll_until_idle=function(e){return this.poll_until(t=>t==e)},b.Device.prototype.do_download=async function(e,t,n){let r=0,i=t.byteLength,o=0;for(this.logInfo("Copying data from browser to DFU device"),this.logProgress(r,i);r<i;){let n;let s=Math.min(i-r,e),a=0;try{a=await this.download(t.slice(r,r+s),o++),this.logDebug("Sent "+a+" bytes"),n=await this.poll_until_idle(b.dfuDNLOAD_IDLE)}catch(e){throw"Error during DFU download: "+e}if(n.status!=b.STATUS_OK)throw"DFU DOWNLOAD failed state=".concat(n.state,", status=").concat(n.status);this.logDebug("Wrote "+a+" bytes"),r+=a,this.logProgress(r,i)}this.logDebug("Sending empty block");try{await this.download(new ArrayBuffer([]),o++)}catch(e){throw"Error during final DFU download: "+e}if(this.logInfo("Wrote "+r+" bytes"),this.logInfo("Manifesting new firmware dfu.js"),n){let e;console.log("manifestationTolerant");try{if((e=await this.poll_until(e=>e==b.dfuIDLE||e==b.dfuMANIFEST_WAIT_RESET)).state==b.dfuMANIFEST_WAIT_RESET&&this.logDebug("Device transitioned to MANIFEST_WAIT_RESET even though it is manifestation tolerant"),e.status!=b.STATUS_OK)throw"DFU MANIFEST failed state=".concat(e.state,", status=").concat(e.status)}catch(e){if(e.endsWith("ControlTransferIn failed: NotFoundError: Device unavailable.")||e.endsWith("ControlTransferIn failed: NotFoundError: The device was disconnected."))this.logWarning("Unable to poll final manifestation status");else throw"Error during DFU manifest: "+e}}else{console.log("NO manifestationTolerant");try{let e=await this.getStatus();this.logDebug("Final DFU status: state=".concat(e.state,", status=").concat(e.status))}catch(e){this.logDebug("Manifest GET_STATUS poll error: "+e)}}try{await this.device_.reset()}catch(e){if("NetworkError: Unable to reset the device."==e||"NotFoundError: Device unavailable."==e||"NotFoundError: The device was disconnected."==e)this.logDebug("Ignored reset error");else throw"Error during reset for manifestation: "+e}};let S={};S.GET_COMMANDS=0,S.SET_ADDRESS=33,S.ERASE_SECTOR=65,S.Device=function(e,t){b.Device.call(this,e,t),this.memoryInfo=null,this.startAddress=NaN,t.name&&(console.log("parseMemoryDescriptor"),this.memoryInfo=S.parseMemoryDescriptor(t.name))},S.Device.prototype=Object.create(b.Device.prototype),S.Device.prototype.constructor=S.Device,S.parseMemoryDescriptor=function(e){let t;let n=e.indexOf("/");if(!e.startsWith("@")||-1==n)throw'Not a DfuSe memory descriptor: "'.concat(e,'"');let r=e.substring(1,n).trim(),i=e.substring(n),o=[],s={" ":1,B:1,K:1024,M:1048576},a=/\/\s*(0x[0-9a-fA-F]{1,8})\s*\/(\s*[0-9]+\s*\*\s*[0-9]+\s?[ BKM]\s*[abcdefg]\s*,?\s*)+/g;for(;t=a.exec(i);){let e,n=/([0-9]+)\s*\*\s*([0-9]+)\s?([ BKM])\s*([abcdefg])\s*,?\s*/g,r=parseInt(t[1],16);for(;e=n.exec(t[0]);){let t={},n=parseInt(e[1],10),i=parseInt(e[2])*s[e[3]],a=e[4].charCodeAt(0)-97+1;t.start=r,t.sectorSize=i,t.end=r+i*n,t.readable=(1&a)!=0,t.erasable=(2&a)!=0,t.writable=(4&a)!=0,o.push(t),r+=i*n}}return{name:r,segments:o}},S.Device.prototype.dfuseCommand=async function(e,t,n){void 0===t&&void 0===n&&(t=0,n=1);let r=new ArrayBuffer(n+1),i=new DataView(r);if(i.setUint8(0,e),1==n)i.setUint8(1,t);else if(4==n)i.setUint32(1,t,!0);else throw"Don't know how to handle data of len "+n;try{await this.download(r,0)}catch(t){throw"Error during special DfuSe command "+({0:"GET_COMMANDS",33:"SET_ADDRESS",65:"ERASE_SECTOR"})[e]+":"+t}if((await this.poll_until(e=>e!=b.dfuDNBUSY)).status!=b.STATUS_OK)throw"Special DfuSe command "+commandName+" failed"},S.Device.prototype.getSegment=function(e){if(!this.memoryInfo||!this.memoryInfo.segments)throw"No memory map information available";for(let t of this.memoryInfo.segments)if(t.start<=e&&e<t.end)return t;return null},S.Device.prototype.getSectorStart=function(e,t){if(void 0===t&&(t=this.getSegment(e)),!t)throw"Address ".concat(e.toString(16)," outside of memory map");let n=Math.floor((e-t.start)/t.sectorSize);return t.start+n*t.sectorSize},S.Device.prototype.getSectorEnd=function(e,t){if(void 0===t&&(t=this.getSegment(e)),!t)throw"Address ".concat(e.toString(16)," outside of memory map");let n=Math.floor((e-t.start)/t.sectorSize);return t.start+(n+1)*t.sectorSize},S.Device.prototype.getFirstWritableSegment=function(){if(!this.memoryInfo||!this.memoryInfo.segments)throw"No memory map information available";for(let e of this.memoryInfo.segments)if(e.writable)return e;return null},S.Device.prototype.getMaxReadSize=function(e){if(!this.memoryInfo||!this.memoryInfo.segments)throw"No memory map information available";let t=0;for(let n of this.memoryInfo.segments)if(n.start<=e&&e<n.end){if(!n.readable)return 0;t+=n.end-e}else if(n.start==e+t){if(n.readable)t+=n.end-n.start;else break}return t},S.Device.prototype.erase=async function(e,t){let n=this.getSegment(e),r=this.getSectorStart(e,n),i=this.getSectorEnd(e+t-1),o=0,s=i-r;for(s>0&&this.logProgress(o,s);r<i;){if(n.end<=r&&(n=this.getSegment(r)),!n.erasable){o=Math.min(o+n.end-r,s),r=n.end,this.logProgress(o,s);continue}let e=Math.floor((r-n.start)/n.sectorSize),t=n.start+e*n.sectorSize;this.logDebug("Erasing ".concat(n.sectorSize,"B at 0x").concat(t.toString(16))),await this.dfuseCommand(S.ERASE_SECTOR,t,4),r=t+n.sectorSize,o+=n.sectorSize,this.logProgress(o,s)}},S.Device.prototype.do_download=async function(e,t,n){if(!this.memoryInfo||!this.memoryInfo.segments)throw"No memory map available";this.logInfo("Erasing DFU device memory");let r=0,i=t.byteLength,o=this.startAddress;isNaN(o)?(o=this.memoryInfo.segments[0].start,this.logWarning("Using inferred start address 0x"+o.toString(16))):null===this.getSegment(o)&&this.logError("Start address 0x".concat(o.toString(16)," outside of memory map bounds")),await this.erase(o,i),this.logInfo("Copying data from browser to DFU device");let s=o;for(;r<i;){let n;let o=Math.min(i-r,e),a=0;try{await this.dfuseCommand(S.SET_ADDRESS,s,4),this.logDebug("Set address to 0x".concat(s.toString(16))),a=await this.download(t.slice(r,r+o),2),this.logDebug("Sent "+a+" bytes"),n=await this.poll_until_idle(b.dfuDNLOAD_IDLE),s+=o}catch(e){throw"Error during DfuSe download: "+e}if(n.status!=b.STATUS_OK)throw"DFU DOWNLOAD failed state=".concat(n.state,", status=").concat(n.status);this.logDebug("Wrote "+a+" bytes"),r+=a,this.logProgress(r,i)}this.logInfo("Wrote ".concat(r," bytes")),this.logInfo("Manifesting new firmware dfuse.js");try{console.log("Manifesting address"),console.log("Manifesting address",S.SET_ADDRESS,o),await this.dfuseCommand(S.SET_ADDRESS,o,4),await this.download(new ArrayBuffer,0)}catch(e){throw"Error during DfuSe manifestation: "+e}try{console.log("Manifesting poll_until",this.device),console.trace(),await this.poll_until(e=>e==b.dfuMANIFEST)}catch(e){this.logError(e)}},S.Device.prototype.do_upload=async function(e,t){let n=this.startAddress;return isNaN(n)?(n=this.memoryInfo.segments[0].start,this.logWarning("Using inferred start address 0x"+n.toString(16))):null===this.getSegment(n)&&this.logWarning("Start address 0x".concat(n.toString(16)," outside of memory map bounds")),this.logInfo("Reading up to 0x".concat(t.toString(16)," bytes starting at 0x").concat(n.toString(16))),await this.getState()!=b.dfuIDLE&&await this.abortToIdle(),await this.dfuseCommand(S.SET_ADDRESS,n,4),await this.abortToIdle(),await b.Device.prototype.do_upload.call(this,e,t,2)};let w=async function(e,t){if(t.some(e=>null==e.name)){let n=new b.Device(e,t[0]);await n.device_.open(),await n.device_.selectConfiguration(1);let r=await n.readInterfaceNames();for(let e of(await n.close(),t))if(null===e.name){let t=e.configuration.configurationValue,n=e.interface.interfaceNumber,i=e.alternate.alternateSetting;e.name=r[t][n][i]}}},T=function(e){console.log(e)},E=function(e){},I=function(e){},U=function(e){},N=function(e,t){},A=async(e,t)=>{try{await e.open()}catch(e){throw _(e),e}let n={};try{var r;n=await (r=e).readConfigurationDescriptor(0).then(e=>{let t=b.parseConfigurationDescriptor(e),n=null,i=r.settings.configuration.configurationValue;if(t.bConfigurationValue==i){for(let e of t.descriptors)if(33==e.bDescriptorType&&e.hasOwnProperty("bcdDFUVersion")){n=e;break}}return n?{WillDetach:(8&n.bmAttributes)!=0,ManifestationTolerant:(4&n.bmAttributes)!=0,CanUpload:(2&n.bmAttributes)!=0,CanDnload:(1&n.bmAttributes)!=0,TransferSize:n.wTransferSize,DetachTimeOut:n.wDetachTimeOut,DFUVersion:n.bcdDFUVersion}:{}},e=>{})}catch(e){throw _(e),e}if(n&&Object.keys(n).length>0&&(e.properties=n,n.CanDnload&&t(n.ManifestationTolerant),282==n.DFUVersion&&2==e.settings.alternate.interfaceProtocol&&(e=new S.Device(e.device_,e.settings))),e.logDebug=T,e.logInfo=E,e.logWarning=I,e.logError=U,e.logProgress=N,e.memoryInfo){let t=e.getFirstWritableSegment();t&&(2415919104===t.start&&(t.start+=262144),e.startAddress=t.start)}return e},_=()=>{console.log("DISCONNECTED")},x=async(e,t,n)=>{e&&(e.close().then(_),e=null),navigator.usb.requestDevice({filters:[]}).then(async e=>{let r=b.findDeviceDfuInterfaces(e);if(0==r.length)statusDisplay.textContent="The selected device does not have any USB DFU interfaces.";else if(1==r.length)await w(e,r),t(await A(new b.Device(e,r[0]),n));else{async function i(){let i=r.filter(e=>e.name.includes("0x08000000"));0===i.length?(console.log("No interace with flash address 0x08000000 found."),statusDisplay.textContent="The selected device does not have a Flash Memory sectiona at address 0x08000000."):t(await A(new b.Device(e,i[0]),n))}await w(e,r),await i()}}).catch(e=>{console.log(e)})},C=async(e,t,n,r)=>{if(console.log("PROGRAM"),e&&null!=n){try{(await e.getStatus()).state==b.dfuERROR&&await e.clearStatus()}catch(t){e.logWarning("Failed to clear status")}await e.do_download(1024,n,r).then(()=>{console.log("PROGRAM DONE"),r||e.waitDisconnected(5e3).then(e=>{_(),t(null)},e=>{console.log("Device unexpectedly tolerated manifestation.")})},e=>{console.log("PROGRAM ERROR"),console.log(e)})}};function j(){let[e,t]=(0,o.useState)("");v(e=>e.firmwareBinFile);let n=v(e=>e.device);v(e=>e.manifestationTolerant);let r=e=>{v.setState({firmwareBinFile:e})},s=e=>{v.setState({manifestationTolerant:e})},a=async()=>{await x(n,r,s)};return(0,i.jsx)("div",{className:"card bg-primary text-primary-content w-full",children:(0,i.jsxs)("div",{className:"card-body",children:[(0,i.jsx)("h2",{className:"card-title",children:"Connect Device"}),(0,i.jsx)("p",{children:"Plug in device click buttons"}),(0,i.jsx)("p",{children:n?"Connected to ".concat(n):"No Device Connected"}),(0,i.jsx)("div",{className:"card-actions justify-end",children:(0,i.jsx)("button",{className:"btn",onClick:a,children:"Connect to Device"})})]})})}function O(){let e=v(e=>e.firmwareBinFile),t=v(e=>e.device),n=v(e=>e.manifestationTolerant),r=e=>{v.setState({firmwareBinFile:e})},o=async()=>{console.log(t),C(t,r,firmwareFile,n)};return(0,i.jsx)("div",{className:"card bg-primary text-primary-content w-full",children:(0,i.jsxs)("div",{className:"card-body",children:[(0,i.jsx)("h2",{className:"card-title",children:"Program Device"}),(0,i.jsx)("div",{className:"card-actions justify-end",children:(0,i.jsx)("button",{className:e&&t?"btn":"btn-disabled",onClick:o,children:"Program Device"})})]})})}function F(){return(0,i.jsx)("div",{className:"flex flex-col items-center min-h-screen py-8 font-mono",children:(0,i.jsxs)("div",{className:"items-center grid gap-6",children:[(0,i.jsx)(c,{}),(0,i.jsx)(j,{}),(0,i.jsx)(y,{}),(0,i.jsx)(O,{})]})})}}},function(e){e.O(0,[971,23,744],function(){return e(e.s=747)}),_N_E=e.O()}]);